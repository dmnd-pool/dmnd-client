(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{333:(e,t,a)=>{"use strict";a.d(t,{d:()=>r});var n=a(5155),l=a(2115),s=a(4884),i=a(9434);let r=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,n.jsx)(s.bL,{className:(0,i.cn)("peer focus-visible:ring-ring focus-visible:ring-offset-background data-[state=checked]:bg-primary data-[state=unchecked]:bg-input inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",a),...l,ref:t,children:(0,n.jsx)(s.zi,{className:(0,i.cn)("bg-background pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});r.displayName=s.bL.displayName},4944:(e,t,a)=>{"use strict";a.d(t,{k:()=>i});var n=a(5155);a(2115);var l=a(5863),s=a(9434);function i(e){let{className:t,value:a,...i}=e;return(0,n.jsx)(l.bL,{"data-slot":"progress",className:(0,s.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...i,children:(0,n.jsx)(l.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}},5127:(e,t,a)=>{"use strict";a.d(t,{Table:()=>s,TableBody:()=>r,TableCell:()=>d,TableHead:()=>c,TableHeader:()=>i,TableRow:()=>o});var n=a(5155);a(2115);var l=a(9434);function s(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,n.jsx)("table",{"data-slot":"table",className:(0,l.cn)("w-full caption-bottom text-sm",t),...a})})}function i(e){let{className:t,...a}=e;return(0,n.jsx)("thead",{"data-slot":"table-header",className:(0,l.cn)("[&_tr]:border-b",t),...a})}function r(e){let{className:t,...a}=e;return(0,n.jsx)("tbody",{"data-slot":"table-body",className:(0,l.cn)("[&_tr:last-child]:border-0",t),...a})}function o(e){let{className:t,...a}=e;return(0,n.jsx)("tr",{"data-slot":"table-row",className:(0,l.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function c(e){let{className:t,...a}=e;return(0,n.jsx)("th",{"data-slot":"table-head",className:(0,l.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,n.jsx)("td",{"data-slot":"table-cell",className:(0,l.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},6550:(e,t,a)=>{Promise.resolve().then(a.bind(a,9438))},6844:(e,t,a)=>{"use strict";a.d(t,{Ou:()=>u,X1:()=>o,g0:()=>d});var n=a(5155),l=a(2115),s=a(1320),i=a(6671);let r=(0,l.createContext)(void 0);function o(e){let{children:t,wsUrl:a="ws://localhost:3001/ws/jd/stream"}=e,[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),x=(0,l.useRef)(null),g=(0,l.useCallback)(e=>{c(t=>[e,...t].slice(0,100))},[]);(0,l.useEffect)(()=>{let e=new s.A(a);return x.current=e,e.onopen=()=>{g({event:"WebSocketOpen",timestamp:new Date().toLocaleString(),level:"INFO",message:"Connected to job declaration stream"})},e.onmessage=e=>{try{let t=JSON.parse(e.data),a={event:t.event,timestamp:new Date(1e3*t.timestamp).toLocaleString(),level:"INFO",message:t.message};g(a),"NewTemplate"===t.event?u(t.template_id):u(null),i.oR.info(t.event,{description:t.message,action:"NewTemplate"===t.event?{label:"Select Transactions",onClick:()=>{let e=document.querySelector(".data-table-container");e&&e.scrollIntoView({behavior:"smooth"})}}:void 0,duration:1e4})}catch(e){console.error("JobDeclarationProvider: Failed to parse WebSocket message:",e),g({event:"WebSocketParseError",timestamp:new Date().toLocaleString(),level:"ERROR",message:"Failed to parse WebSocket message: ".concat(e instanceof Error?e.message:"Unknown error")})}},e.onerror=e=>{g({event:"WebSocketError",timestamp:new Date().toLocaleString(),level:"ERROR",message:"WebSocket connection error"})},e.onclose=()=>{g({event:"WebSocketClose",timestamp:new Date().toLocaleString(),level:"WARNING",message:"Disconnected from job declaration stream"})},()=>{x.current&&(x.current.close(),x.current=null)}},[a,g]);let p=(0,l.useCallback)(async e=>{if(!d)return i.oR.error("No template available",{description:"Please wait for a new template notification before declaring a job."}),!1;if(0===e.length)return i.oR.error("No transactions selected",{description:"Please select at least one transaction to declare a job."}),!1;h(!0);try{let t=await fetch("http://localhost:3001/api/job-declaration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template_id:d,txids:e})}),a=await t.json();if(a.success){i.oR.success("Job Declaration Successful!",{description:"Successfully declared job with ".concat(e.length," transactions for template ").concat(d,".")});let t={event:"JobDeclarationSuccess",timestamp:new Date().toLocaleString(),level:"INFO",message:"Job declared successfully with ".concat(e.length," transactions (template_id: ").concat(d,")")};return g(t),!0}{i.oR.error("Job Declaration Failed",{description:a.message||"An unknown error occurred."});let e={event:"JobDeclarationError",timestamp:new Date().toLocaleString(),level:"ERROR",message:"Job declaration failed: ".concat(a.message||"Unknown error")};return g(e),!1}}catch(t){let e=t instanceof Error?t.message:"Network error";return i.oR.error("Job Declaration Failed",{description:"Failed to declare job: ".concat(e)}),g({event:"JobDeclarationError",timestamp:new Date().toLocaleString(),level:"ERROR",message:"Job declaration failed: ".concat(e)}),!1}finally{h(!1)}},[d,g]);return(0,n.jsx)(r.Provider,{value:{logs:o,currentTemplateId:d,declareJob:p,isLoading:m,addLog:g},children:t})}function c(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useJobDeclaration must be used within a JobDeclarationProvider");return e}function d(){let{logs:e,addLog:t}=c();return{logs:e,addLog:t}}function u(){let{currentTemplateId:e,declareJob:t,isLoading:a}=c();return{currentTemplateId:e,declareJob:t,isLoading:a}}},9438:(e,t,a)=>{"use strict";a.d(t,{Transactions:()=>e1});var n=a(5155),l=a(2115),s=a(3464),i=a(1320),r=a(6671),o=a(9434),c=a(6127),d=a(6695),u=a(285),m=a(6268),h=a(5127);let x={sortOrders:[{label:"Asc",value:"asc"},{label:"Desc",value:"desc"}]};function g(e){let{column:t,withBorder:a=!1}=e,n=t.getIsPinned(),l="left"===n&&t.getIsLastColumn("left"),s="right"===n&&t.getIsFirstColumn("right");return{boxShadow:a?l?"-4px 0 4px -4px hsl(var(--border)) inset":s?"4px 0 4px -4px hsl(var(--border)) inset":void 0:void 0,left:"left"===n?"".concat(t.getStart("left"),"px"):void 0,right:"right"===n?"".concat(t.getAfter("right"),"px"):void 0,opacity:n?.97:1,position:n?"sticky":"relative",background:"hsl(var(--background))",width:t.getSize(),zIndex:+!!n}}var p=a(2278),f=a(2767),b=a(9409),v=a(3096);function j(e){let{table:t,pageSizeOptions:a=[10,20,30,40,50],className:l,...s}=e;return(0,n.jsxs)("div",{className:(0,o.cn)("flex w-full flex-col-reverse items-center justify-between gap-4 overflow-auto p-1 sm:flex-row sm:gap-8",l),...s,children:[(0,n.jsx)("div",{className:"text-muted-foreground flex-1 text-sm whitespace-nowrap",children:t.getFilteredSelectedRowModel().rows.length>0?(0,n.jsxs)(n.Fragment,{children:[t.getFilteredSelectedRowModel().rows.length," of"," ",t.getFilteredRowModel().rows.length," row(s) selected."]}):(0,n.jsxs)(n.Fragment,{children:[t.getFilteredRowModel().rows.length," row(s) total."]})}),(0,n.jsxs)("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{className:"text-sm font-medium whitespace-nowrap",children:"Rows per page"}),(0,n.jsxs)(b.l6,{value:"".concat(t.getState().pagination.pageSize),onValueChange:e=>{t.setPageSize(Number(e))},children:[(0,n.jsx)(b.bq,{className:"h-8 w-[4.5rem] [&[data-size]]:h-8",children:(0,n.jsx)(b.yv,{placeholder:t.getState().pagination.pageSize})}),(0,n.jsx)(b.gC,{side:"top",children:a.map(e=>(0,n.jsx)(b.eb,{value:"".concat(e),children:e},e))})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",t.getState().pagination.pageIndex+1," of"," ",t.getPageCount()]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.$,{"aria-label":"Go to first page",variant:"outline",size:"icon",className:"hidden size-8 lg:flex",onClick:()=>t.setPageIndex(0),disabled:!t.getCanPreviousPage(),children:(0,n.jsx)(p.A,{})}),(0,n.jsx)(u.$,{"aria-label":"Go to previous page",variant:t.getCanPreviousPage()?"default":"outline",size:"icon",className:"size-8",onClick:()=>t.previousPage(),disabled:!t.getCanPreviousPage(),children:(0,n.jsx)(v.YJP,{})}),(0,n.jsx)(u.$,{"aria-label":"Go to next page",variant:t.getCanNextPage()?"default":"outline",size:"icon",className:"size-8",onClick:()=>t.nextPage(),disabled:!t.getCanNextPage(),children:(0,n.jsx)(v.vKP,{})}),(0,n.jsx)(u.$,{"aria-label":"Go to last page",variant:"outline",size:"icon",className:"hidden size-8 lg:flex",onClick:()=>t.setPageIndex(t.getPageCount()-1),disabled:!t.getCanNextPage(),children:(0,n.jsx)(f.A,{})})]})]})]})}function w(e){var t;let{table:a,actionBar:l,children:s,className:i,...r}=e;return(0,n.jsxs)("div",{className:(0,o.cn)("flex w-full flex-col gap-2.5 overflow-auto",i),...r,children:[s,(0,n.jsx)("div",{className:"overflow-hidden rounded-md border",children:(0,n.jsxs)(h.Table,{children:[(0,n.jsx)(h.TableHeader,{children:a.getHeaderGroups().map(e=>(0,n.jsx)(h.TableRow,{children:e.headers.map(e=>(0,n.jsx)(h.TableHead,{colSpan:e.colSpan,style:{...g({column:e.column})},className:"text-muted-foreground",children:e.isPlaceholder?null:(0,m.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,n.jsx)(h.TableBody,{children:(null==(t=a.getRowModel().rows)?void 0:t.length)?a.getRowModel().rows.map(e=>(0,n.jsx)(h.TableRow,{"data-state":e.getIsSelected()&&"selected",className:(0,o.cn)("hover:ring-primary hover:ring-1"),children:e.getVisibleCells().map(e=>(0,n.jsx)(h.TableCell,{style:{...g({column:e.column})},children:(0,m.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(h.TableRow,{children:(0,n.jsx)(h.TableCell,{colSpan:a.getAllColumns().length,className:"h-24 text-center",children:"No results."})})})]})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2.5",children:[(0,n.jsx)(j,{table:a}),l&&a.getFilteredSelectedRowModel().rows.length>0&&l]})]})}var S=a(9145),y=a(8922),N=a(2525),C=a(6126),T=a(4636),k=a(5143),R=a(1206),A=a(402),z=a(8266),F=a(9708);function D(e,t){let{checkForDefaultPrevented:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(n){if(null==e||e(n),!1===a||!n.defaultPrevented)return null==t?void 0:t(n)}}function I(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function E(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return l.useCallback(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return e=>{let a=!1,n=t.map(t=>{let n=I(t,e);return a||"function"!=typeof n||(a=!0),n});if(a)return()=>{for(let e=0;e<n.length;e++){let a=n[e];"function"==typeof a?a():I(t[e],null)}}}}(...t),t)}var M=a(7650);let P={vertical:{modifiers:[R.FN,R.gj],strategy:A._G,collisionDetection:k.fp},horizontal:{modifiers:[R.dU,R.gj],strategy:A.m$,collisionDetection:k.fp},mixed:{modifiers:[R.gj],strategy:void 0,collisionDetection:k.y$}},B="Sortable",_="SortableContent",L="SortableItem",O="SortableItemHandle",V="SortableOverlay",W={[B]:"`".concat(B,"` components must be within `").concat(B,"`"),[_]:"`".concat(_,"` must be within `").concat(B,"`"),[L]:"`".concat(L,"` must be within `").concat(_,"`"),[O]:"`".concat(O,"` must be within `").concat(L,"`"),[V]:"`".concat(V,"` must be within `").concat(B,"`")},J=l.createContext(null);function K(e){let t=l.useContext(J);if(!t)throw Error(W[e]);return t}function q(e){let{value:t,onValueChange:a,collisionDetection:s,modifiers:i,strategy:r,onMove:o,orientation:c="vertical",flatCursor:d=!1,getItemValue:u,accessibility:m,...h}=e,x=l.useId(),[g,p]=l.useState(null),f=(0,k.FR)((0,k.MS)(k.cA),(0,k.MS)(k.IG),(0,k.MS)(k.uN,{coordinateGetter:A.JR})),b=l.useMemo(()=>P[c],[c]),v=l.useCallback(e=>{if("object"==typeof e&&!u)throw Error("getItemValue is required when using array of objects.");return u?u(e):e},[u]),j=l.useMemo(()=>t.map(e=>v(e)),[t,v]),w=l.useCallback(e=>{let{active:n,over:l}=e;if(l&&n.id!==(null==l?void 0:l.id)){let s=t.findIndex(e=>v(e)===n.id),i=t.findIndex(e=>v(e)===l.id);o?o({...e,activeIndex:s,overIndex:i}):null==a||a((0,A.be)(t,s,i))}p(null)},[t,a,o,v]),S=l.useMemo(()=>({onDragStart(e){var a;let{active:n}=e,l=n.id.toString();return'Grabbed sortable item "'.concat(l,'". Current position is ').concat((null==(a=n.data.current)?void 0:a.sortable.index)+1," of ").concat(t.length,". Use arrow keys to move, space to drop.")},onDragOver(e){let{active:a,over:n}=e;if(n){var l,s,i,r;let e=null!=(i=null==(l=n.data.current)?void 0:l.sortable.index)?i:0,o=null!=(r=null==(s=a.data.current)?void 0:s.sortable.index)?r:0,c=a.id.toString();return'Sortable item "'.concat(c,'" moved ').concat(e>o?"down":"up"," to position ").concat(e+1," of ").concat(t.length,".")}return"Sortable item is no longer over a droppable area. Press escape to cancel."},onDragEnd(e){let{active:a,over:n}=e,l=a.id.toString();if(n){var s,i;let e=null!=(i=null==(s=n.data.current)?void 0:s.sortable.index)?i:0;return'Sortable item "'.concat(l,'" dropped at position ').concat(e+1," of ").concat(t.length,".")}return'Sortable item "'.concat(l,'" dropped. No changes were made.')},onDragCancel(e){var a,n;let{active:l}=e,s=null!=(n=null==(a=l.data.current)?void 0:a.sortable.index)?n:0,i=l.id.toString();return'Sorting cancelled. Sortable item "'.concat(i,'" returned to position ').concat(s+1," of ").concat(t.length,".")},onDragMove(e){let{active:a,over:n}=e;if(n){var l,s,i,r;let e=null!=(i=null==(l=n.data.current)?void 0:l.sortable.index)?i:0,o=null!=(r=null==(s=a.data.current)?void 0:s.sortable.index)?r:0,c=a.id.toString();return'Sortable item "'.concat(c,'" is moving ').concat(e>o?"down":"up"," to position ").concat(e+1," of ").concat(t.length,".")}return"Sortable item is no longer over a droppable area. Press escape to cancel."}}),[t]),y=l.useMemo(()=>({draggable:"\n        To pick up a sortable item, press space or enter.\n        While dragging, use the ".concat("vertical"===c?"up and down":"horizontal"===c?"left and right":"arrow"," keys to move the item.\n        Press space or enter again to drop the item in its new position, or press escape to cancel.\n      ")}),[c]),N=l.useMemo(()=>({id:x,items:j,modifiers:null!=i?i:b.modifiers,strategy:null!=r?r:b.strategy,activeId:g,setActiveId:p,getItemValue:v,flatCursor:d}),[x,j,i,r,b.modifiers,b.strategy,g,v,d]);return(0,n.jsx)(J.Provider,{value:N,children:(0,n.jsx)(k.Mp,{collisionDetection:null!=s?s:b.collisionDetection,modifiers:null!=i?i:b.modifiers,sensors:f,...h,id:x,onDragStart:D(h.onDragStart,e=>{let{active:t}=e;return p(t.id)}),onDragEnd:D(h.onDragEnd,w),onDragCancel:D(h.onDragCancel,()=>p(null)),accessibility:{announcements:S,screenReaderInstructions:y,...m}})})}J.displayName=B;let H=l.createContext(!1);H.displayName=_;let U=l.forwardRef((e,t)=>{let{strategy:a,asChild:l,withoutSlot:s,children:i,...r}=e,o=K(_),c=l?F.DX:"div";return(0,n.jsx)(H.Provider,{value:!0,children:(0,n.jsx)(A.gB,{items:o.items,strategy:null!=a?a:o.strategy,children:s?i:(0,n.jsx)(c,{...r,ref:t,children:i})})})});U.displayName=_;let $=l.createContext(null);$.displayName=L;let G=l.forwardRef((e,t)=>{let{value:a,style:s,asHandle:i,asChild:r,disabled:c,className:d,...u}=e,m=l.useContext(H),h=l.useContext(X);if(!m&&!h)throw Error(W[L]);if(""===a)throw Error("`".concat(L,"` value cannot be an empty string"));let x=K(L),g=l.useId(),{attributes:p,listeners:f,setNodeRef:b,setActivatorNodeRef:v,transform:j,transition:w,isDragging:S}=(0,A.gl)({id:a,disabled:c}),y=E(t,e=>{!c&&(b(e),i&&v(e))}),N=l.useMemo(()=>({transform:z.Ks.Translate.toString(j),transition:w,...s}),[j,w,s]),C=l.useMemo(()=>({id:g,attributes:p,listeners:f,setActivatorNodeRef:v,isDragging:S,disabled:c}),[g,p,f,v,S,c]),T=r?F.DX:"div";return(0,n.jsx)($.Provider,{value:C,children:(0,n.jsx)(T,{id:g,"data-dragging":S?"":void 0,...u,...i?p:{},...i?f:{},tabIndex:c?void 0:0,ref:y,style:N,className:(0,o.cn)("focus-visible:ring-ring focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden",{"touch-none select-none":i,"cursor-default":x.flatCursor,"data-dragging:cursor-grabbing":!x.flatCursor,"cursor-grab":!S&&i&&!x.flatCursor,"opacity-50":S,"pointer-events-none opacity-50":c},d)})})});G.displayName=L;let Z=l.forwardRef((e,t)=>{let{asChild:a,disabled:s,className:i,...r}=e,c=l.useContext($);if(!c)throw Error(W[O]);let d=K(O),u=null!=s?s:c.disabled,m=E(t,e=>{u&&c.setActivatorNodeRef(e)}),h=a?F.DX:"button";return(0,n.jsx)(h,{type:"button","aria-controls":c.id,"data-dragging":c.isDragging?"":void 0,...r,...c.attributes,...c.listeners,ref:m,className:(0,o.cn)("select-none disabled:pointer-events-none disabled:opacity-50",d.flatCursor?"cursor-default":"cursor-grab data-dragging:cursor-grabbing",i),disabled:u})});Z.displayName=O;let X=l.createContext(!1);X.displayName=V;let Y={sideEffects:(0,k.WB)({styles:{active:{opacity:"0.4"}}})};function Q(e){var t;let{container:a,children:s,...i}=e,r=K(V),[c,d]=l.useState(!1);l.useLayoutEffect(()=>d(!0),[]);let u=null!=a?a:c?null==(t=globalThis.document)?void 0:t.body:null;return u?M.createPortal((0,n.jsx)(k.Hd,{dropAnimation:Y,modifiers:r.modifiers,className:(0,o.cn)(!r.flatCursor&&"cursor-grabbing"),...i,children:(0,n.jsx)(X.Provider,{value:!0,children:r.activeId?"function"==typeof s?s({value:r.activeId}):s:null})}),u):null}let ee=["backspace","delete"];function et(e){let{table:t,...a}=e,s=l.useId(),i=l.useId(),r=l.useId(),[c,d]=l.useState(!1),m=l.useRef(null),h=t.getState().sorting,x=t.setSorting,{columnLabels:g,columns:p}=l.useMemo(()=>{let e=new Map,a=new Set(h.map(e=>e.id)),n=[];for(let i of t.getAllColumns()){var l,s;if(!i.getCanSort())continue;let t=null!=(s=null==(l=i.columnDef.meta)?void 0:l.label)?s:i.id;e.set(i.id,t),a.has(i.id)||n.push({id:i.id,label:t})}return{columnLabels:e,columns:n}},[h,t]),f=l.useCallback(()=>{let e=p[0];e&&x(t=>[...t,{id:e.id,desc:!1}])},[p,x]),b=l.useCallback((e,t)=>{x(a=>a?a.map(a=>a.id===e?{...a,...t}:a):a)},[x]),v=l.useCallback(e=>{x(t=>t.filter(t=>t.id!==e))},[x]),j=l.useCallback(()=>x(t.initialState.sorting),[x,t.initialState.sorting]);l.useEffect(()=>{function e(e){!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&("s"!==e.key.toLowerCase()||e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),d(!0)),"s"===e.key.toLowerCase()&&e.shiftKey&&h.length>0&&(e.preventDefault(),j()))}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h.length,j]);let w=l.useCallback(e=>{ee.includes(e.key.toLowerCase())&&h.length>0&&(e.preventDefault(),j())},[h.length,j]);return(0,n.jsxs)(q,{value:h,onValueChange:x,getItemValue:e=>e.id,children:[(0,n.jsxs)(T.AM,{open:c,onOpenChange:d,children:[(0,n.jsx)(T.Wv,{asChild:!0,children:(0,n.jsxs)(u.$,{variant:"outline",size:"sm",onKeyDown:w,children:[(0,n.jsx)(y.A,{}),"Sort",h.length>0&&(0,n.jsx)(C.E,{variant:"default",className:"h-[18.24px] rounded-[3.2px] px-[5.12px] font-mono text-[10.4px] font-normal",children:h.length})]})}),(0,n.jsxs)(T.hl,{"aria-labelledby":i,"aria-describedby":r,className:"flex w-full max-w-[var(--radix-popover-content-available-width)] origin-[var(--radix-popover-content-transform-origin)] flex-col gap-3.5 p-4 sm:min-w-[380px]",...a,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("h4",{id:i,className:"leading-none font-medium",children:h.length>0?"Sort by":"No sorting applied"}),(0,n.jsx)("p",{id:r,className:(0,o.cn)("text-muted-foreground text-sm",h.length>0&&"sr-only"),children:h.length>0?"Modify sorting to organize your rows.":"Add sorting to organize your rows."})]}),h.length>0&&(0,n.jsx)(U,{asChild:!0,children:(0,n.jsx)("div",{role:"list",className:"flex max-h-[300px] flex-col gap-2 overflow-y-auto p-1",children:h.map(e=>(0,n.jsx)(ea,{sort:e,sortItemId:"".concat(s,"-sort-").concat(e.id),columns:p,columnLabels:g,onSortUpdate:b,onSortRemove:v},e.id))})}),(0,n.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,n.jsx)(u.$,{size:"sm",className:"rounded",ref:m,onClick:f,disabled:0===p.length,children:"Add sort"}),h.length>0&&(0,n.jsx)(u.$,{variant:"outline",size:"sm",className:"rounded",onClick:j,children:"Reset sorting"})]})]})]}),(0,n.jsx)(Q,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"bg-primary/10 h-8 w-[180px] rounded-sm"}),(0,n.jsx)("div",{className:"bg-primary/10 h-8 w-24 rounded-sm"}),(0,n.jsx)("div",{className:"bg-primary/10 size-8 shrink-0 rounded-sm"}),(0,n.jsx)("div",{className:"bg-primary/10 size-8 shrink-0 rounded-sm"})]})})]})}function ea(e){let{sort:t,sortItemId:a,columnLabels:s,onSortUpdate:i,onSortRemove:r}=e,o="".concat(a,"-field-listbox"),c="".concat(a,"-field-trigger"),d="".concat(a,"-direction-listbox"),[m,h]=l.useState(!1),[g,p]=l.useState(!1),f=l.useCallback(e=>{!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&(m||g||ee.includes(e.key.toLowerCase())&&(e.preventDefault(),r(t.id)))},[t.id,m,g,r]);return(0,n.jsx)(G,{value:t.id,asChild:!0,children:(0,n.jsxs)("div",{role:"listitem",id:a,tabIndex:-1,className:"flex items-center gap-2",onKeyDown:f,children:[(0,n.jsx)(T.AM,{open:m,onOpenChange:h,children:(0,n.jsx)(T.Wv,{asChild:!0,children:(0,n.jsxs)(u.$,{id:c,role:"combobox","aria-controls":o,variant:"outline",size:"sm",className:"w-44 justify-between rounded font-normal",children:[(0,n.jsx)("span",{className:"truncate",children:s.get(t.id)}),(0,n.jsx)(v.TBE,{className:"opacity-50"})]})})}),(0,n.jsxs)(b.l6,{open:g,onOpenChange:p,value:t.desc?"desc":"asc",onValueChange:e=>i(t.id,{desc:"desc"===e}),children:[(0,n.jsx)(b.bq,{"aria-controls":d,className:"h-8 w-24 rounded [&[data-size]]:h-8",children:(0,n.jsx)(b.yv,{})}),(0,n.jsx)(b.gC,{id:d,className:"min-w-[var(--radix-select-trigger-width)] origin-[var(--radix-select-content-transform-origin)]",children:x.sortOrders.map(e=>(0,n.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]}),(0,n.jsx)(u.$,{"aria-controls":a,variant:"outline",size:"icon",className:"size-8 shrink-0 rounded",onClick:()=>r(t.id),children:(0,n.jsx)(N.A,{})}),(0,n.jsx)(Z,{asChild:!0,children:(0,n.jsx)(u.$,{variant:"outline",size:"icon",className:"size-8 shrink-0 rounded",children:(0,n.jsx)(v.YtH,{})})})]})})}var en=a(2346),el=a(6102),es=a(4631),ei=a(5084),er=a(8192);function eo(e){var t;let{table:a,visible:s,container:i,children:r,className:c,...d}=e,[u,m]=l.useState(!1);l.useLayoutEffect(()=>{m(!0)},[]),l.useEffect(()=>{function e(e){"Escape"===e.key&&a.toggleAllRowsSelected(!1)}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a]);let h=null!=i?i:u?null==(t=globalThis.document)?void 0:t.body:null;if(!h)return null;let x=null!=s?s:a.getFilteredSelectedRowModel().rows.length>0;return M.createPortal((0,n.jsx)(ei.N,{children:x&&(0,n.jsx)(er.P.div,{role:"toolbar","aria-orientation":"horizontal",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2,ease:"easeInOut"},className:(0,o.cn)("bg-background text-foreground fixed inset-x-0 bottom-6 z-50 mx-auto flex w-fit flex-wrap items-center justify-center gap-2 rounded-md border p-2 shadow-sm",c),...d,children:r})}),h)}function ec(e){let{size:t="sm",tooltip:a,isPending:l,disabled:s,className:i,children:r,...c}=e,d=(0,n.jsx)(u.$,{variant:"secondary",size:t,className:(0,o.cn)("border-secondary bg-secondary/50 hover:bg-secondary/70 gap-1.5 border [&>svg]:size-3.5","icon"===t?"size-7":"h-7",i),disabled:s||l,...c,children:l?(0,n.jsx)(es.A,{className:"animate-spin"}):r});return a?(0,n.jsxs)(el.m_,{children:[(0,n.jsx)(el.k$,{asChild:!0,children:d}),(0,n.jsx)(el.ZI,{sideOffset:6,className:"bg-accent text-foreground border font-semibold dark:bg-zinc-900 [&>span]:hidden",children:(0,n.jsx)("p",{children:a})})]}):d}function ed(e){let{table:t}=e,a=l.useCallback(()=>{t.toggleAllRowsSelected(!1)},[t]);return(0,n.jsxs)("div",{className:"flex h-7 items-center rounded-md border pr-1 pl-2.5",children:[(0,n.jsxs)("span",{className:"text-xs whitespace-nowrap",children:[t.getFilteredSelectedRowModel().rows.length," selected"]}),(0,n.jsx)(en.Separator,{orientation:"vertical",className:"mr-1 ml-2 data-[orientation=vertical]:h-4"}),(0,n.jsxs)(el.m_,{children:[(0,n.jsx)(el.k$,{asChild:!0,children:(0,n.jsx)(u.$,{variant:"ghost",size:"icon",className:"size-5",onClick:a,children:(0,n.jsx)(v.MKb,{className:"size-3.5"})})}),(0,n.jsxs)(el.ZI,{sideOffset:10,className:"bg-accent text-foreground flex items-center gap-2 border px-2 py-1 font-semibold dark:bg-zinc-900 [&>span]:hidden",children:[(0,n.jsx)("p",{children:"Clear selection"}),(0,n.jsx)("kbd",{className:"bg-background text-foreground rounded border px-1.5 py-px font-mono text-[0.7rem] font-normal shadow-xs select-none",children:(0,n.jsx)("abbr",{title:"Escape",className:"no-underline",children:"Esc"})})]})]})]})}var eu=a(3977),em=a(3790);class eh{static filterTransactions(e,t){if(!t.enabled)return[];let a=e.filter(e=>!(e.feeRate<t.minFeeRate)&&(void 0===t.maxSize||!(e.vsize>t.maxSize))&&(void 0===t.minBaseFee||!(e.fees.base<t.minBaseFee))&&(void 0===t.maxAncestorCount||!(e.ancestor_count>t.maxAncestorCount))&&(void 0===t.maxDescendantCount||!(e.descendant_count>t.maxDescendantCount))&&(!t.excludeBip125Replaceable||!e.bip125_replaceable)&&(!t.excludeUnbroadcast||!e.unbroadcast)&&!0);return void 0!==t.maxTransactionCount&&(a=a.slice(0,t.maxTransactionCount)),a}static getMatchingSummary(e,t){if(!t.enabled)return{total:e.length,matching:0,willSelect:0};let a=this.filterTransactions(e,t),n=t.maxTransactionCount?Math.min(a.length,t.maxTransactionCount):a.length;return{total:e.length,matching:a.length,willSelect:n}}static validateCriteria(e){let t=[];return void 0!==e.maxTransactionCount&&e.maxTransactionCount<=0&&t.push("Maximum transaction count must be greater than 0"),t}static getCriteriaDescription(e){if(!e.enabled)return"Auto-selection is disabled";let t=[];return t.push("Min fee rate: ".concat(e.minFeeRate," sat/vB")),void 0!==e.maxSize&&t.push("Max size: ".concat(e.maxSize," vBytes")),void 0!==e.maxTransactionCount&&t.push("Max ".concat(e.maxTransactionCount," transactions")),e.excludeBip125Replaceable&&t.push("Exclude BIP125 replaceable"),e.excludeUnbroadcast&&t.push("Exclude unbroadcast"),t.length>0?t.join(", "):"No specific criteria"}}async function ex(e,t,a,n,l,s,i){try{let r=function(e){let t=new URLSearchParams;return t.append("selectionStrategy",e.selectionStrategy),t.append("minFeeRate",e.minFeeRate.toString()),[{key:"maxSize",value:e.maxSize},{key:"minBaseFee",value:e.minBaseFee},{key:"maxAncestorCount",value:e.maxAncestorCount},{key:"maxDescendantCount",value:e.maxDescendantCount},{key:"excludeBip125Replaceable",value:e.excludeBip125Replaceable},{key:"excludeUnbroadcast",value:e.excludeUnbroadcast},{key:"maxTransactionCount",value:e.maxTransactionCount}].forEach(e=>{let{key:a,value:n,shouldInclude:l}=e;void 0!==n&&(!l||l(n))&&t.append(a,n.toString())}),t}(e),o="http://localhost:3001/api/auto-select?".concat(r.toString()),c=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}});if(!c.ok)throw Error("Auto-select API error: ".concat(c.status," ").concat(c.statusText));let d=await c.json();if(!d.success||!d.data||!Array.isArray(d.data))throw Error("Invalid API response format");await eg(d.data,t,a,n,l,s,i,!1)}catch(c){console.error("Auto-selection API failed, falling back to local filtering:",c),l.general.showNotifications&&r.oR.warning("Using local filtering",{description:"API unavailable, using local transaction filtering",duration:3e3});let o=eh.filterTransactions(t,e);await eg(o,t,a,n,l,s,i,!0)}}async function eg(e,t,a,n,l,s,i,o){if(0===e.length){l.general.showNotifications&&r.oR.info("No matching transactions",{description:"No transactions match the current auto-selection criteria",duration:3e3});return}let c=new Set(t.map(e=>e.txid)),d=e.map(e=>e.txid).filter(e=>c.has(e));if(0===d.length){l.general.showNotifications&&r.oR.warning("No valid transactions",{description:"Matching transactions are no longer in the mempool",duration:3e3});return}l.autoSelection.onNewTemplate.clearExistingSelections&&(s.onSelectTransactions([]),await new Promise(e=>setTimeout(e,100)));let u=new Set(a),m=d.filter(e=>!u.has(e)),h=d.filter(e=>u.has(e));if(l.general.pauseOnSelection&&i&&s.onToggleFetching&&s.onToggleFetching(),s.onSelectTransactions(d),l.general.showNotifications){let e=l.autoSelection.onNewTemplate.requireTemplate&&n?" for template ".concat(n):"",t=function(e,t,a,n,l,s){let i=s?" using local criteria":"";return n?"Selected ".concat(e," transactions").concat(l," (cleared previous selections)").concat(i):t>0&&a>0?"Added ".concat(t," new transactions (").concat(a," already selected)").concat(l).concat(i):t>0?"Selected ".concat(t," transactions").concat(l).concat(i):"All ".concat(a," matching transactions were already selected").concat(l).concat(i)}(d.length,m.length,h.length,l.autoSelection.onNewTemplate.clearExistingSelections,e,o);r.oR.success("Auto-selection ".concat(o?"(local)":"completed"),{description:t,duration:5e3})}l.general.autoScrollToTable&&setTimeout(()=>{let e=document.querySelector(".data-table-container");e&&e.scrollIntoView({behavior:"smooth"})},100),l.autoSelection.onNewTemplate.autoJobDeclaration&&s.onDeclareJob&&n&&d.length>0&&await ep(d,n,s.onDeclareJob,l.general.showNotifications,o)}async function ep(e,t,a,n,l){try{await new Promise(e=>setTimeout(e,200)),await a(e)&&n&&r.oR.success("Auto job declaration ".concat(l?"(local)":"completed"),{description:"Successfully declared job with ".concat(e.length," transactions for template ").concat(t),duration:5e3})}catch(e){console.error("Auto job declaration failed:",e),n&&r.oR.error("Auto job declaration failed",{description:"Failed to automatically declare job".concat(l?" (local mode)":""),duration:5e3})}}var ef=a(4382),eb=a(1539),ev=a(2486),ej=a(5690),ew=a(381),eS=a(5057),ey=a(2523),eN=a(333);let eC=[{value:"maximizeFees",label:"Maximize Fees",description:"Select transactions to maximize total fees (default)"},{value:"maximizeCount",label:"Maximize Count",description:"Select maximum number of transactions"},{value:"balanced",label:"Balanced",description:"Balanced approach between fees and count"}];function eT(e){let{onClose:t}=e,{autoSelection:a,updateAutoSelection:l}=(0,em.sA)(),{saveSettings:s,isSaving:i}=(0,em.t0)(),r=a.onNewTemplate,o=e=>{l({onNewTemplate:{...r,...e}})},c=async()=>{try{await s()}catch(e){console.error("Failed to save settings:",e)}};return(0,n.jsxs)("div",{className:"space-y-6 px-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eS.J,{className:"text-base font-medium",children:"Enable Auto-Selection"}),(0,n.jsx)("p",{className:"text-muted-foreground text-sm",children:"Automatically select transactions when new templates arrive"})]}),(0,n.jsx)(eN.d,{checked:r.enabled,onCheckedChange:e=>o({enabled:e})})]}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(en.Separator,{}),(0,n.jsxs)("div",{className:"flex items-end justify-between gap-4",children:[(0,n.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,n.jsx)(eS.J,{className:"text-lg",children:"Selection Strategy"}),(0,n.jsxs)(b.l6,{value:r.selectionStrategy,onValueChange:e=>o({selectionStrategy:e}),children:[(0,n.jsx)(b.bq,{children:(0,n.jsx)(b.yv,{placeholder:"Select strategy"})}),(0,n.jsx)(b.gC,{children:eC.map(e=>(0,n.jsx)(b.eb,{value:e.value,children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"font-medium",children:e.label}),(0,n.jsx)("div",{className:"text-muted-foreground text-xs",children:e.description})]})},e.value))})]})]}),(0,n.jsx)("div",{className:"flex gap-2 pb-1",children:(0,n.jsx)(u.$,{onClick:c,disabled:i,variant:"default",size:"sm",className:"min-w-[100px]",children:i?"Saving...":"Save Settings"})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"min-fee-rate",children:"Min Fee Rate (sat/vB)"}),(0,n.jsx)(ey.p,{id:"min-fee-rate",type:"number",value:r.minFeeRate||"",onChange:e=>o({minFeeRate:Number(e.target.value)||1}),placeholder:"1",min:"1"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"max-size",children:"Max Size (vBytes)"}),(0,n.jsx)(ey.p,{id:"max-size",type:"number",value:r.maxSize||"",onChange:e=>o({maxSize:Number(e.target.value)||void 0}),placeholder:"100000"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"min-base-fee",children:"Min Base Fee (sats)"}),(0,n.jsx)(ey.p,{id:"min-base-fee",type:"number",value:r.minBaseFee||"",onChange:e=>o({minBaseFee:Number(e.target.value)||void 0}),placeholder:"1000"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"max-count",children:"Max Transaction Count"}),(0,n.jsx)(ey.p,{id:"max-count",type:"number",value:r.maxTransactionCount||"",onChange:e=>o({maxTransactionCount:Number(e.target.value)||void 0}),placeholder:"100",min:"1"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"max-ancestor",children:"Max Ancestor Count"}),(0,n.jsx)(ey.p,{id:"max-ancestor",type:"number",value:r.maxAncestorCount||"",onChange:e=>o({maxAncestorCount:Number(e.target.value)||void 0}),placeholder:"25",min:"1"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"max-descendant",children:"Max Descendant Count"}),(0,n.jsx)(ey.p,{id:"max-descendant",type:"number",value:r.maxDescendantCount||"",onChange:e=>o({maxDescendantCount:Number(e.target.value)||void 0}),placeholder:"25",min:"1"})]})]}),(0,n.jsx)(en.Separator,{}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium",children:"Selection Preferences"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)(eS.J,{htmlFor:"require-template",children:"Require Template"}),(0,n.jsx)("p",{className:"text-muted-foreground text-xs",children:"Only run auto-selection when a template is available"})]}),(0,n.jsx)(eN.d,{id:"require-template",checked:r.requireTemplate||!1,onCheckedChange:e=>o({requireTemplate:e})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)(eS.J,{htmlFor:"clear-existing",children:"Clear Existing Selections"}),(0,n.jsx)("p",{className:"text-muted-foreground text-xs",children:"Remove current selections before auto-selecting new ones"})]}),(0,n.jsx)(eN.d,{id:"clear-existing",checked:r.clearExistingSelections||!1,onCheckedChange:e=>o({clearExistingSelections:e})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)(eS.J,{htmlFor:"periodic-enabled",children:"Enable Periodic Auto-Selection"}),(0,n.jsx)("p",{className:"text-muted-foreground text-xs",children:"Run auto-selection at regular intervals"})]}),(0,n.jsx)(eN.d,{id:"periodic-enabled",checked:r.periodicEnabled||!1,onCheckedChange:e=>o({periodicEnabled:e})})]}),r.periodicEnabled&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eS.J,{htmlFor:"periodic-interval",children:"Interval (seconds)"}),(0,n.jsx)(ey.p,{id:"periodic-interval",type:"number",value:r.periodicInterval||30,onChange:e=>o({periodicInterval:Number(e.target.value)||30}),placeholder:"30",min:"5",max:"300"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)(eS.J,{htmlFor:"auto-job-declaration",children:"Auto Job Declaration"}),(0,n.jsx)("p",{className:"text-muted-foreground text-xs",children:"Automatically declare job after successful auto-selection"})]}),(0,n.jsx)(eN.d,{id:"auto-job-declaration",checked:r.autoJobDeclaration||!1,onCheckedChange:e=>o({autoJobDeclaration:e})})]})]})]}),(0,n.jsx)(en.Separator,{}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium",children:"Exclusion Preferences"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eS.J,{htmlFor:"exclude-replaceable",children:"Exclude BIP125 Replaceable"}),(0,n.jsx)(eN.d,{id:"exclude-replaceable",checked:r.excludeBip125Replaceable||!1,onCheckedChange:e=>o({excludeBip125Replaceable:e})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eS.J,{htmlFor:"exclude-unbroadcast",children:"Exclude Unbroadcast"}),(0,n.jsx)(eN.d,{id:"exclude-unbroadcast",checked:r.excludeUnbroadcast||!1,onCheckedChange:e=>o({excludeUnbroadcast:e})})]})]})]})]})]})}function ek(e){let{currentTemplateId:t,onManualAutoSelection:a}=e,{settings:s}=(0,em.t0)(),[i,r]=(0,l.useState)(!1),o=s.autoSelection.onNewTemplate.enabled,c=s.autoSelection.onNewTemplate.requireTemplate,d=s.autoSelection.onNewTemplate.periodicEnabled,m=s.autoSelection.onNewTemplate.autoJobDeclaration,h=o&&(!c||t);return(0,n.jsxs)("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[o&&(0,n.jsx)(C.E,{variant:"outline",className:"flex items-center gap-1",children:c?"Template Required":"No Template Required"}),o&&d&&(0,n.jsxs)(C.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,n.jsx)(eb.A,{className:"h-3 w-3"}),"Periodic: ",s.autoSelection.onNewTemplate.periodicInterval,"s"]}),o&&m&&(0,n.jsxs)(C.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,n.jsx)(ev.A,{className:"h-3 w-3"}),"Auto Job Declaration"]}),(0,n.jsxs)(u.$,{variant:"outline",size:"sm",onClick:a,disabled:!h,className:"flex items-center gap-2",title:o?c&&!t?"Template required but not available":"Run auto-selection now":"Auto-selection is disabled",children:[(0,n.jsx)(ej.A,{className:"h-3 w-3"}),"Run Auto-Selection"]}),(0,n.jsxs)(u.$,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>r(!0),children:[(0,n.jsx)(ew.A,{className:"h-3 w-3"}),"Settings"]}),(0,n.jsx)(ef.a,{title:"Auto-Selection Settings",description:"Configure auto-selection criteria for transaction selection when new templates arrive.",isOpen:i,onClose:()=>r(!1),size:"5xl",children:(0,n.jsx)(eT,{onClose:()=>r(!1)})})]})}var eR=a(6981),eA=a(5196);function ez(e){let{className:t,...a}=e;return(0,n.jsx)(eR.bL,{"data-slot":"checkbox",className:(0,o.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,n.jsx)(eR.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,n.jsx)(eA.A,{className:"size-3.5"})})})}var eF=a(772),eD=a(1243);function eI(e){let{transaction:t,isSelected:a,onSelectionChange:l,canSelect:s=!0,validationMessage:i="",disabled:r=!1,className:c}=e;return(0,n.jsx)(el.Bc,{children:(0,n.jsxs)(el.m_,{children:[(0,n.jsx)(el.k$,{asChild:!0,children:(0,n.jsx)("div",{className:(0,o.cn)("flex items-center gap-1",c),children:(0,n.jsx)(ez,{checked:a,onCheckedChange:e=>{(!e||s||a)&&l(e)},disabled:r||!s,"aria-label":"Select transaction ".concat(t.txid.slice(0,8),"...")})})}),!s&&i&&(0,n.jsxs)(el.ZI,{side:"right",className:"max-w-xs",children:[(0,n.jsx)("p",{className:"text-sm",children:!s&&i?i:null}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-1 text-xs text-orange-200",children:[(0,n.jsx)(eD.A,{className:"h-3 w-3"}),"Validation failed"]})]})]})})}var eE=a(4357),eM=a(3786),eP=a(8395);let eB=e=>(0,n.jsx)("div",{className:"flex h-8 items-center justify-center gap-1",children:e}),e_=e=>{let{txid:t}=e,a=t.slice(0,4)+"..."+t.slice(-4),l=async e=>{e.stopPropagation();try{await navigator.clipboard.writeText(t),r.oR.success("Transaction ID copied to clipboard")}catch(e){r.oR.error("Failed to copy transaction ID")}};return(0,n.jsx)(el.Bc,{children:(0,n.jsxs)(el.m_,{children:[(0,n.jsx)(el.k$,{asChild:!0,children:(0,n.jsxs)("div",{className:"group flex cursor-pointer items-center gap-1",children:[(0,n.jsx)("span",{onClick:l,className:"transition-colors hover:text-blue-600",children:a}),(0,n.jsxs)("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,n.jsx)(u.$,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:l,title:"Copy full transaction ID",children:(0,n.jsx)(eE.A,{className:"h-3 w-3"})}),(0,n.jsx)(u.$,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:e=>{e.stopPropagation(),window.open("https://mempool.space/tx/".concat(t),"_blank","noopener,noreferrer")},title:"View on mempool.space",children:(0,n.jsx)(eM.A,{className:"h-3 w-3"})})]})]})}),(0,n.jsx)(el.ZI,{side:"bottom",children:(0,n.jsx)("div",{className:"text-center font-mono text-xs",children:t})})]})})},eL=[{id:"txid",accessorKey:"txid",title:"Txid",formatter:e=>(0,n.jsx)(e_,{txid:e}),meta:{label:"txid",placeholder:"Search by txid",variant:"text",icon:eP.A},enableSorting:!1,enableColumnFilter:!0},{id:"feeRate",accessorKey:"feeRate",title:"FeeRate (sat/vB)",formatter:e=>e.toPrecision(4),meta:{label:"Fee Rate",variant:"range",range:[0,1e3]},enableSorting:!0,enableColumnFilter:!0},{id:"vsize",accessorKey:"vsize",title:"Size (vB)",formatter:e=>e,meta:{label:"vsize",variant:"range",range:[0,1e6]},enableSorting:!0,enableColumnFilter:!0},{id:"fees.base",accessorKey:"fees.base",title:"Base Fee (sat)",formatter:e=>e.toLocaleString(),meta:{label:"Base Fee",variant:"range",range:[0,1e6]},enableSorting:!0,enableColumnFilter:!0},{id:"depends",accessorKey:"depends",title:"Depends On",formatter:e=>{if(!e||!Array.isArray(e))return 0;let t=e.length;return(0,n.jsx)("span",{title:t>0?"Depends on: ".concat(e.slice(0,3).map(e=>e.slice(0,8)+"...").join(", ")).concat(e.length>3?" and ".concat(e.length-3," more"):""):"No dependencies",children:t})},meta:{label:"Depends On",variant:"number"},enableSorting:!0,enableColumnFilter:!0,filterFn:(e,t,a)=>{let n=e.getValue(t);return n&&Array.isArray(n)?n.length===Number(a):0===a}},{id:"descendant_count",accessorKey:"descendant_count",title:"Descendant Count",formatter:e=>e,enableSorting:!0,enableColumnFilter:!0},{id:"descendant_size",accessorKey:"descendant_size",title:"Descendant Size",formatter:e=>e,enableSorting:!0,enableColumnFilter:!0},{id:"ancestor_count",accessorKey:"ancestor_count",title:"Ancestor Count",formatter:e=>e,enableSorting:!0,enableColumnFilter:!0},{id:"ancestor_size",accessorKey:"ancestor_size",title:"Ancestor Size",formatter:e=>e,enableSorting:!0,enableColumnFilter:!0},{id:"time",accessorKey:"time",title:"Time",formatter:e=>new Date(1e3*e).toLocaleString(),enableSorting:!0,enableColumnFilter:!0},{id:"height",accessorKey:"height",title:"Height",formatter:e=>e,enableSorting:!0,enableColumnFilter:!0},{id:"bip125_replaceable",accessorKey:"bip125_replaceable",title:"BIP125 Replaceable",formatter:e=>(0,n.jsx)(ez,{checked:e,disabled:!0}),meta:{label:"BIP125 Replaceable",variant:"boolean"},enableSorting:!0,enableColumnFilter:!0}],eO=[{id:"select",header:e=>{let{table:t}=e;return(0,n.jsx)(ez,{checked:t.getIsAllPageRowsSelected()||t.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:e=>t.toggleAllPageRowsSelected(!!e),"aria-label":"Select all"})},cell:e=>{let{row:t}=e;return(0,n.jsx)(ez,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),"aria-label":"Select row"})},meta:{label:"Checkbox",placeholder:"select transaction",variant:"text",icon:eP.A},size:32,enableHiding:!1},...eL.map(e=>({id:e.id,accessorKey:e.accessorKey,header:t=>{let{column:a}=t;return(0,n.jsx)(eF.w,{column:a,title:e.title,className:"w-full justify-center"})},cell:t=>{let{cell:a}=t;return eB(e.formatter(a.getValue()))},...e.meta&&{meta:e.meta},enableSorting:e.enableSorting,enableColumnFilter:e.enableColumnFilter,...e.filterFn&&{filterFn:e.filterFn},..."depends"===e.id&&{sortingFn:(e,t,a)=>{let n=e.getValue(a),l=t.getValue(a);return(n&&Array.isArray(n)?n.length:0)-(l&&Array.isArray(l)?l.length:0)}}}))],eV=[{id:"select",cell:e=>{let{row:t}=e;return(0,n.jsx)(ez,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),"aria-label":"Select row"})},meta:{label:"Checkbox",placeholder:"deselect transaction",variant:"text",icon:eP.A},size:32,enableHiding:!1},...eO.slice(1,5)];var eW=a(4944);function eJ(e){let{isOpen:t,selectedData:a,handleModal:s}=e,i=l.useMemo(()=>{if(0===a.length)return{totalTransactions:0,totalVirtualSize:0,totalWeight:0,totalFees:0,averageFeeRate:0,maxAncestorCount:0,maxDescendantCount:0};let e=a.length,t=a.reduce((e,t)=>e+t.vsize,0),n=a.reduce((e,t)=>e+(t.weight||4*t.vsize),0),l=a.reduce((e,t)=>e+t.fees.base,0);return{totalTransactions:e,totalVirtualSize:t,totalWeight:n,totalFees:l,averageFeeRate:t>0?l/t:0,maxAncestorCount:Math.max(...a.map(e=>e.ancestor_count)),maxDescendantCount:Math.max(...a.map(e=>e.descendant_count))}},[a]),r=i.totalWeight/4e6*100;return(0,n.jsx)(ef.a,{title:"Transaction Summary",description:"Aggregate statistics for selected transactions",isOpen:t,onClose:()=>s(!1),size:"4xl",children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{className:"pb-2",children:(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Transactions"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"text-2xl font-bold",children:[i.totalTransactions,(0,n.jsx)("span",{className:"text-muted-foreground ml-1 text-sm font-normal",children:"txs"})]})})]}),(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{className:"pb-2",children:(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Virtual Size"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"text-2xl font-bold",children:[i.totalVirtualSize,(0,n.jsx)("span",{className:"text-muted-foreground ml-1 text-sm font-normal",children:"vbytes"})]})})]}),(0,n.jsxs)(d.Zp,{children:[(0,n.jsxs)(d.aR,{className:"pb-2",children:[(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Weight"}),(0,n.jsxs)(d.BT,{children:[r.toFixed(2),"% of max block weight"]})]}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold",children:[i.totalWeight,(0,n.jsxs)("span",{className:"text-muted-foreground ml-1 text-sm font-normal",children:["/ ",4e6]})]}),(0,n.jsx)(eW.k,{value:Math.min(r,100),className:"h-2"})]})})]}),(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{className:"pb-2",children:(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Fees"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold",children:[(i.totalFees/1e8).toFixed(8),(0,n.jsx)("span",{className:"text-muted-foreground ml-1 text-sm font-normal",children:"BTC"})]}),(0,n.jsxs)("div",{className:"text-muted-foreground text-sm",children:[i.totalFees," sats"]})]})})]}),(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{className:"pb-2",children:(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Average Fee Rate"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"text-2xl font-bold",children:[i.averageFeeRate.toFixed(1),(0,n.jsx)("span",{className:"text-muted-foreground ml-1 text-sm font-normal",children:"sat/vB"})]})})]}),(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{className:"pb-2",children:(0,n.jsx)(d.ZB,{className:"text-sm font-medium",children:"Chain Metrics"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground text-sm",children:"Max Ancestors:"}),(0,n.jsx)(C.E,{variant:"secondary",children:i.maxAncestorCount})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground text-sm",children:"Max Descendants:"}),(0,n.jsx)(C.E,{variant:"secondary",children:i.maxDescendantCount})]})]})})]})]}),i.totalTransactions>0&&(0,n.jsxs)(d.Zp,{children:[(0,n.jsx)(d.aR,{children:(0,n.jsx)(d.ZB,{className:"text-lg",children:"Additional Details"})}),(0,n.jsx)(d.Wu,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 text-sm md:grid-cols-2",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Average tx size:"}),(0,n.jsxs)("span",{children:[(i.totalVirtualSize/i.totalTransactions).toFixed(0)," ","vbytes"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Average tx weight:"}),(0,n.jsxs)("span",{children:[(i.totalWeight/i.totalTransactions).toFixed(0)," ","weight units"]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Average fee per tx:"}),(0,n.jsxs)("span",{children:[(i.totalFees/i.totalTransactions).toFixed(0)," ","sats"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Block space usage:"}),(0,n.jsxs)("span",{children:[r.toFixed(4),"%"]})]})]})]})})]})]})})}var eK=a(6844);function eq(e){let{isOpen:t,selectedData:a,parentTable:s,handleModal:i}=e,[r,o]=l.useState(!1),{declareJob:c,isLoading:d,currentTemplateId:m}=(0,eK.Ou)(),h=async()=>{let e=a.map(e=>e.txid);await c(e)&&(s.toggleAllRowsSelected(!1),setTimeout(()=>i(!1),1e3))},x=l.useMemo(()=>eV.map(e=>"select"===e.id?{...e,cell:e=>{var t,a;let{row:l}=e,i=()=>{try{return s.getRow(l.original.txid)}catch(e){return null}};return(0,n.jsx)(ez,{checked:null!=(a=null==(t=i())?void 0:t.getIsSelected())&&a,onCheckedChange:e=>{let t=i();t&&t.toggleSelected(!!e)},"aria-label":"Select row"})}}:e),[s]),{table:g}=(0,eu.u)({data:a,columns:x,getRowId:e=>e.txid});return(0,n.jsxs)(ef.a,{title:"Selected Transactions",description:"Review the selected transactions",isOpen:t,onClose:()=>i(!1),size:"6xl",children:[(0,n.jsx)("div",{className:"max-h-[75vh] overflow-auto",children:(0,n.jsx)(w,{table:g,children:(0,n.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2",children:[(0,n.jsx)(S.w,{table:g}),(0,n.jsx)(et,{table:g}),a.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.$,{variant:m?"default":"secondary",size:"sm",onClick:h,disabled:!m||d,children:[(0,n.jsx)(ev.A,{className:"h-4 w-4"}),d?"Declaring...":"Declare Job"]}),(0,n.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>o(!0),children:"Summary"}),(0,n.jsx)(u.$,{variant:"destructive",size:"sm",onClick:()=>{s.toggleAllRowsSelected(!1),setTimeout(()=>i(!1),800)},children:"Deselect All"})]})]})})}),(0,n.jsx)(eJ,{isOpen:r,selectedData:a,handleModal:o})]})}var eH=a(646);function eU(e){let{validationState:t,selectionSummary:a,selectedCount:l}=e,s=Math.min(t.weightUtilization,100);return(0,n.jsxs)(d.Zp,{className:"mb-2 gap-4 rounded-lg border p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[t.isValid?(0,n.jsx)(eH.A,{className:"h-4 w-4 text-green-500"}):(0,n.jsx)(eD.A,{className:"h-4 w-4 text-red-500"}),(0,n.jsx)("span",{className:"font-medium",children:"Bitcoin Mining Validation"})]}),t.isValid?(0,n.jsx)(C.E,{variant:"default",children:"Valid Selection"}):(0,n.jsx)(C.E,{variant:"destructive",children:"Invalid Selection"})]}),(0,n.jsx)("div",{className:"text-muted-foreground text-sm",children:a}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsx)("span",{children:"Block Weight Usage:"}),(0,n.jsxs)("span",{className:(0,o.cn)("font-medium",s>100?"text-red-500":s>90?"text-orange-500":"text-green-600"),children:[s.toFixed(1),"%"]})]}),(0,n.jsx)(eW.k,{value:Math.min(s,100),className:(0,o.cn)("h-2",s>100&&"bg-red-100")}),(0,n.jsxs)("div",{className:"text-muted-foreground flex justify-between text-xs",children:[(0,n.jsxs)("span",{children:[t.totalWeight.toLocaleString()," / 4,000,000 weight units"]}),(0,n.jsx)("span",{children:t.remainingCapacity>0?"".concat(t.remainingCapacity.toLocaleString()," remaining"):"Limit exceeded"})]}),t.dependencyIssues>0&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-orange-600",children:[(0,n.jsx)(eD.A,{className:"h-3 w-3"}),(0,n.jsxs)("span",{children:[t.dependencyIssues," dependency issue(s)"]})]})]})]})}var e$=a(2657),eG=a(2713),eZ=a(1788);let eX={MAX_BLOCK_WEIGHT:4e6};class eY{static validateSelection(e,t){let a=[],n=this.calculateTotalWeight(e),l=n/eX.MAX_BLOCK_WEIGHT*100;n>eX.MAX_BLOCK_WEIGHT&&a.push("Total weight (".concat(n.toLocaleString(),") exceeds Bitcoin block limit (").concat(eX.MAX_BLOCK_WEIGHT.toLocaleString(),")"));let s=this.checkDependencies(e,t);return s.length>0&&a.push("".concat(s.length," transaction(s) have unmet dependencies. Child transactions require their parent transactions to be included.")),{isValid:0===a.length,errors:a,warnings:[],totalWeight:n,weightUtilization:l,dependencyViolations:s}}static canAddTransaction(e,t,a){let n=[...t,e],l=this.validateSelection(n,a),s=this.calculateTotalWeight(t)+this.calculateTotalWeight([e]),i=l.isValid,r=eX.MAX_BLOCK_WEIGHT-s,o="";if(i)o="Can add transaction. Remaining capacity: ".concat(r.toLocaleString()," weight units (").concat((r/eX.MAX_BLOCK_WEIGHT*100).toFixed(1),"%)");else if(s>eX.MAX_BLOCK_WEIGHT)o="Cannot add transaction: would exceed block weight limit by ".concat((s-eX.MAX_BLOCK_WEIGHT).toLocaleString()," weight units");else if(l.dependencyViolations.length>0){var c;let t=(null==(c=l.dependencyViolations.find(t=>t.childTxid===e.txid))?void 0:c.missingParents)||[];o=t.length>0?"Cannot add transaction: missing ".concat(t.length," parent transaction(s)"):"Cannot add transaction: would create dependency violations"}return{canSelect:i,totalSelectedWeight:s,remainingWeight:r,weightUtilization:l.weightUtilization,dependencyIssues:l.dependencyViolations.length,message:o}}static canAddTransactions(e,t,a){let n=[...t,...e],l=this.validateSelection(n,a),s=this.calculateTotalWeight(t)+this.calculateTotalWeight(e),i=l.isValid,r=eX.MAX_BLOCK_WEIGHT-s,o="";return i?o="Can add ".concat(e.length," transaction(s). Remaining capacity: ").concat(r.toLocaleString()," weight units"):s>eX.MAX_BLOCK_WEIGHT?o="Cannot add ".concat(e.length," transaction(s): would exceed block weight limit by ").concat((s-eX.MAX_BLOCK_WEIGHT).toLocaleString()," weight units"):l.dependencyViolations.length>0&&(o="Cannot add ".concat(e.length," transaction(s): would create ").concat(l.dependencyViolations.length," dependency violation(s)")),{canSelect:i,totalSelectedWeight:s,remainingWeight:r,weightUtilization:l.weightUtilization,dependencyIssues:l.dependencyViolations.length,message:o}}static calculateTotalWeight(e){return e.reduce((e,t)=>e+(t.weight||4*t.vsize),0)}static checkDependencies(e,t){let a=new Set(e.map(e=>e.txid)),n=new Set(t.map(e=>e.txid));return e.map(e=>{var t;if(!(null==(t=e.depends)?void 0:t.length))return null;let l=Array.from(new Set(e.depends)).filter(e=>n.has(e.toString())&&!a.has(e.toString()));return l.length?{childTxid:e.txid,missingParents:l}:null}).filter(e=>null!==e)}static getSelectionSummary(e,t){if(0===e.length)return"No transactions selected";let a=this.validateSelection(e,t),n=a.weightUtilization.toFixed(1);return a.isValid?"".concat(e.length," transaction(s) selected (").concat(n,"% block capacity)"):"Invalid selection: ".concat(a.errors.join(", "))}static sortByDependencies(e){let t=new Map(e.map(e=>[e.txid,e])),a=[],n=new Set,l=new Set,s=e=>{if(n.has(e)||l.has(e))return;l.add(e);let i=t.get(e);if(i){if(i.depends&&i.depends.length>0)for(let e of i.depends){let a=String(e);t.has(a)&&s(a)}l.delete(e),n.add(e),a.push(i)}};for(let t of e)s(t.txid);return a}static removeInvalidTransactions(e,t){let a=[],n=[],l=[],s=0;for(let t of[...e].sort((e,t)=>t.feeRate-e.feeRate)){let e=t.weight||4*t.vsize;s+e<=eX.MAX_BLOCK_WEIGHT?(a.push(t),s+=e):(n.push(t),l.push("Removed transaction ".concat(t.txid.slice(0,8),"... (would exceed block weight limit)")))}let i=new Set(a.map(e=>e.txid)),r=new Set(t.map(e=>e.txid)),o=[],c=[];for(let e of a){let t=!0;if(e.depends&&e.depends.length>0)for(let a of e.depends){let e=String(a);if(r.has(e)&&!i.has(e)){t=!1;break}}t?o.push(e):(c.push(e),l.push("Removed transaction ".concat(e.txid.slice(0,8),"... (missing parent dependencies)")))}return{validTransactions:this.sortByDependencies(o),removedTransactions:[...n,...c],issues:l}}static cleanAndOptimizeSelection(e,t){if(0===e.length)return{optimizedTransactions:[],removedTransactions:[],summary:"No transactions to clean",issues:[]};let a=this.removeInvalidTransactions(e,t),n=this.validateSelection(a.validTransactions,t),l=0===a.validTransactions.length?"All transactions were invalid and removed":"Cleaned selection: ".concat(a.validTransactions.length," valid transactions remaining (").concat(n.weightUtilization.toFixed(1),"% block capacity)");return{optimizedTransactions:a.validTransactions,removedTransactions:a.removedTransactions,summary:l,issues:a.issues}}}function eQ(e){let{transactions:t,selectedTransactions:a,enableRealTimeValidation:n=!0}=e,s=l.useMemo(()=>n&&0!==a.length?eY.validateSelection(a,t):{isValid:!0,errors:[],warnings:[],totalWeight:0,weightUtilization:0,dependencyViolations:[]},[a,t,n]),i=l.useMemo(()=>eY.getSelectionSummary(a,t),[a,t]),r=l.useMemo(()=>{let e=Math.max(0,4e6-s.totalWeight);return{isValid:s.isValid,totalWeight:s.totalWeight,weightUtilization:s.weightUtilization,dependencyIssues:s.dependencyViolations.length,canAddMore:e>0&&s.isValid,remainingCapacity:e}},[s]),o=l.useCallback(e=>eY.canAddTransaction(e,a,t),[a,t]),c=l.useCallback(e=>eY.canAddTransactions(e,a,t),[a,t]),d=l.useCallback(()=>eY.validateSelection(a,t),[a,t]),u=l.useCallback(e=>eY.sortByDependencies(e),[]);return{canAddTransaction:o,canAddTransactions:c,validateCurrentSelection:d,removeInvalidTransactions:l.useCallback(e=>eY.removeInvalidTransactions(e,t),[t]),cleanAndOptimizeSelection:l.useCallback(e=>eY.cleanAndOptimizeSelection(e,t),[t]),selectionSummary:i,validationState:r,sortByDependencies:u}}function e0(e){let{data:t,isFetching:a,onToggle:s,showAutoSelectionControls:i=!1}=e,[c,m]=l.useState(!1),[h,x]=l.useState(!1),[g,p]=l.useState(!1),[f,b]=l.useState(!1),{declareJob:v,isLoading:j,currentTemplateId:y}=(0,eK.Ou)(),{settings:C}=(0,em.t0)(),{canAddTransaction:T}=eQ({transactions:t,selectedTransactions:[],enableRealTimeValidation:!0}),k=l.useRef(null),R=l.useMemo(()=>(function(e){let{canAddTransaction:t,onRowSelection:a,onSelectAll:l}=e;return[{id:"select",header:e=>{let{table:t}=e,a=t.getRowModel().rows,s=a.filter(e=>e.getIsSelected()),i=a.length>0&&s.length===a.length,r=s.length>0&&!i;return(0,n.jsx)(ez,{checked:i||r&&"indeterminate",onCheckedChange:e=>l(!!e),"aria-label":"Select all transactions"})},cell:e=>{let{row:l}=e,s=l.original,i=l.getIsSelected(),r=t(s);return(0,n.jsx)(eI,{transaction:s,isSelected:i,onSelectionChange:e=>a(s.txid,e),canSelect:r.canSelect,validationMessage:r.message})},meta:{label:"Checkbox",placeholder:"select transaction",variant:"text",icon:eP.A},size:32,enableHiding:!1},...eO.slice(1)]})({canAddTransaction:T,onRowSelection:(e,t)=>{try{var a;let n=null==(a=k.current)?void 0:a.getRow(e);n&&n.toggleSelected(t)}catch(t){console.warn("Transaction ".concat(e," not found in current table data"))}},onSelectAll:e=>{var t;null==(t=k.current)||t.toggleAllPageRowsSelected(e)}}),[T]),{table:A}=(0,eu.u)({data:t,columns:R,getRowId:e=>e.txid});l.useEffect(()=>{k.current=A},[A]);let z=A.getSelectedRowModel().rows,F=l.useMemo(()=>z.map(e=>e.original),[z]),D=l.useMemo(()=>F.map(e=>e.txid),[F]),{selectionSummary:I,validationState:E,cleanAndOptimizeSelection:M,removeInvalidTransactions:P}=eQ({transactions:t,selectedTransactions:F,enableRealTimeValidation:!0});l.useEffect(()=>{if(F.length>0&&!E.isValid&&C.general.autoCleanInvalidTransactions){let e=M(F);e.removedTransactions.length>0&&(A.toggleAllRowsSelected(!1),setTimeout(()=>{e.optimizedTransactions.forEach(e=>{try{let t=A.getRow(e.txid);t&&t.toggleSelected(!0)}catch(t){console.warn("Transaction ".concat(e.txid," not found in current table data"))}})},100),r.oR.warning("Invalid transactions removed",{description:"Removed ".concat(e.removedTransactions.length," invalid transaction(s). ").concat(e.summary),action:{label:"Undo",onClick:()=>{A.toggleAllRowsSelected(!1),setTimeout(()=>{F.forEach(e=>{try{let t=A.getRow(e.txid);t&&t.toggleSelected(!0)}catch(t){console.warn("Transaction ".concat(e.txid," not found"))}})},100)}}}))}},[E.isValid,F.length,M,A,C.general.autoCleanInvalidTransactions]);let B=l.useCallback(()=>{if(0===F.length)return void r.oR.info("No transactions selected to clean");let e=M(F);if(0===e.removedTransactions.length)return void r.oR.success("All selected transactions are valid");A.toggleAllRowsSelected(!1),setTimeout(()=>{e.optimizedTransactions.forEach(e=>{try{let t=A.getRow(e.txid);t&&t.toggleSelected(!0)}catch(t){console.warn("Transaction ".concat(e.txid," not found in current table data"))}})},100),r.oR.success("Selection cleaned",{description:"Removed ".concat(e.removedTransactions.length," invalid transaction(s). ").concat(e.summary)})},[F,M,A]),_=l.useCallback(e=>{if(0===e.length)return void A.toggleAllRowsSelected(!1);e.forEach(e=>{try{let t=A.getRow(e);t&&t.toggleSelected(!0)}catch(t){console.warn("Transaction ".concat(e," not found in current table data"))}})},[A]),{handleManualAutoSelection:L}=function(e){let{transactions:t,onSelectTransactions:a,selectedTxids:n,currentTemplateId:s,isFetching:i,onToggleFetching:o,onDeclareJob:c}=e,{settings:d}=(0,em.t0)(),u=(0,l.useRef)(null),m=(0,l.useRef)(!1),h=(0,l.useRef)(null),x=(0,l.useCallback)(async()=>{if(d.autoSelection.onNewTemplate.enabled&&(!d.autoSelection.onNewTemplate.requireTemplate||s)&&(!d.autoSelection.onNewTemplate.requireTemplate||u.current!==s)&&!m.current){d.autoSelection.onNewTemplate.requireTemplate&&(u.current=s),m.current=!0;try{await ex(d.autoSelection.onNewTemplate,t,n,s,d,{onSelectTransactions:a,onToggleFetching:o,onDeclareJob:c},i)}finally{m.current=!1}}},[d,s,t,a,i,o,c,n]);(0,l.useEffect)(()=>{d.autoSelection.onNewTemplate.enabled&&(!d.autoSelection.onNewTemplate.requireTemplate||s&&u.current!==s)&&x()},[s,d.autoSelection.onNewTemplate.enabled,d.autoSelection.onNewTemplate.requireTemplate]),(0,l.useEffect)(()=>(h.current&&(clearInterval(h.current),h.current=null),d.autoSelection.onNewTemplate.enabled&&d.autoSelection.onNewTemplate.periodicEnabled&&(!d.autoSelection.onNewTemplate.requireTemplate||s)&&(h.current=setInterval(()=>{if(m.current||d.autoSelection.onNewTemplate.requireTemplate&&!s)return;let e=u.current;u.current=null,x().finally(()=>{d.autoSelection.onNewTemplate.requireTemplate&&(u.current=e)})},1e3*(d.autoSelection.onNewTemplate.periodicInterval||30))),()=>{h.current&&(clearInterval(h.current),h.current=null)}),[d.autoSelection.onNewTemplate.enabled,d.autoSelection.onNewTemplate.periodicEnabled,d.autoSelection.onNewTemplate.periodicInterval,d.autoSelection.onNewTemplate.requireTemplate,s,x]);let g=(0,l.useCallback)(async()=>{if(!d.autoSelection.onNewTemplate.enabled)return void r.oR.error("Auto-selection disabled",{description:"Please enable auto-selection in settings first",duration:3e3});if(d.autoSelection.onNewTemplate.requireTemplate&&!s)return void r.oR.error("No template available",{description:'Template is required for auto-selection. Wait for a new template to arrive or disable "Require Template" setting',duration:3e3});if(m.current)return void r.oR.warning("Auto-selection in progress",{description:"Please wait for the current auto-selection to complete",duration:3e3});let e=u.current;u.current=null;try{await x()}finally{d.autoSelection.onNewTemplate.requireTemplate&&(u.current=e)}},[d.autoSelection.onNewTemplate.enabled,d.autoSelection.onNewTemplate.requireTemplate,s,x]);return{getMatchingSummary:(0,l.useCallback)(()=>({onNewTemplate:eh.getMatchingSummary(t,d.autoSelection.onNewTemplate)}),[t,d.autoSelection]),triggerAutoSelection:x,handleManualAutoSelection:g}}({transactions:t,onSelectTransactions:_,selectedTxids:D,currentTemplateId:y,isFetching:a,onToggleFetching:s,onDeclareJob:v}),O=e=>{e?(m(!0),a&&s()):(m(!1),a||s())},V=async()=>{p(!0);try{await (0,o.vD)(F)}catch(e){r.oR.error("Export failed: There was an error exporting the selected transactions: ")}finally{p(!1)}},W=async()=>{b(!0);try{await (0,o.qJ)(F)}catch(e){r.oR.error("Copy failed: There was an error copying the selected transaction IDs.")}finally{b(!1)}},J=async()=>{if(!E.isValid)return void r.oR.error("Cannot declare job",{description:"Selected transactions violate Bitcoin mining criteria. Please fix validation issues first."});let e=F.map(e=>e.txid);await v(e)&&A.toggleAllRowsSelected(!1)},K=(0,n.jsxs)(eo,{table:A,className:"rounded-xl p-4",children:[(0,n.jsx)(ed,{table:A}),(0,n.jsxs)(ec,{tooltip:E.isValid?y?"Declare job with selected transactions (Template ID: ".concat(y,")"):"Wait for template notification to declare job":"Fix validation issues before declaring job",onClick:J,isPending:j,disabled:!E.isValid||!y,children:[(0,n.jsx)(ev.A,{}),"Declare Job"]}),(0,n.jsxs)(ec,{tooltip:"View selected transactions",onClick:()=>O(!0),children:[(0,n.jsx)(e$.A,{}),"View Selected"]}),(0,n.jsxs)(ec,{tooltip:"Show summary of selected transactions",onClick:()=>x(!0),children:[(0,n.jsx)(eG.A,{}),"Summary"]}),(0,n.jsxs)(ec,{tooltip:"Copy transaction IDs to clipboard",onClick:W,isPending:f,children:[(0,n.jsx)(eE.A,{}),"Copy IDs"]}),(0,n.jsxs)(ec,{tooltip:"Export selected transactions to CSV",onClick:V,isPending:g,children:[(0,n.jsx)(eZ.A,{}),"Export"]}),(0,n.jsxs)(ec,{tooltip:"Remove invalid transactions from selection",onClick:B,disabled:0===F.length,children:[(0,n.jsx)(N.A,{}),"Remove Invalid"]})]});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eU,{validationState:E,selectionSummary:I,selectedCount:F.length}),(0,n.jsx)(d.Zp,{children:(0,n.jsx)("div",{className:"px-4",children:(0,n.jsxs)(w,{table:A,actionBar:K,children:[i&&(0,n.jsx)(ek,{transactions:t,currentTemplateId:y,onSelectTransactions:_,selectedTxids:D,isFetching:a,onToggleFetching:s,onManualAutoSelection:L}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(S.w,{table:A}),(0,n.jsx)(u.$,{variant:a?"destructive":"default",size:"sm",onClick:s,children:a?"Pause":"Resume"}),(0,n.jsx)(et,{table:A})]})]})})}),(0,n.jsx)(eJ,{isOpen:h,selectedData:F,handleModal:x}),(0,n.jsx)(eq,{isOpen:c,selectedData:F,parentTable:A,handleModal:O})]})}function e1(){let{transactions:e,isFetching:t,toggle:a}=function(){let[e,t]=l.useState([]),[a,n]=l.useState([]),[c,d]=l.useState(!0),u=l.useRef(c),m=l.useRef(null);return l.useEffect(()=>{s.A.get("http://localhost:3001/api/mempool").then(e=>{t(e.data.map(e=>({...(0,o.FS)(e),feeRate:1e8*e.fees.base/e.vsize})))}).catch(()=>{})},[]),l.useEffect(()=>{u.current=c},[c]),l.useEffect(()=>{let e=new i.A("ws://localhost:3001/ws/bitcoin/stream");return m.current=e,e.onmessage=e=>{let a=JSON.parse(e.data);switch(a.event){case"A":let l={...(0,o.FS)(a.transaction),feeRate:1e8*a.transaction.fees.base/a.transaction.vsize};u.current?t(e=>[l,...e.filter(e=>e.txid!==l.txid)]):n(e=>[l,...e.filter(e=>e.txid!==l.txid)]);break;case"R":t(e=>e.filter(e=>e.txid!==a.txid)),n(e=>e.filter(e=>e.txid!==a.txid));break;case"C":let s=a.block.block_hash.slice(0,10)+"...",i=a.block.height,c=a.block.txids.length-1;r.oR.success("Block #".concat(i," Mined"),{description:"".concat(c," transactions confirmed in block ").concat(s),action:{label:"View Block",onClick:()=>window.open("https://mempool.space/block/".concat(a.block.block_hash),"_blank")}});let d=new Set(a.block.txids);t(e=>e.filter(e=>!d.has(e.txid))),n(e=>e.filter(e=>!d.has(e.txid)));break;case"D":let m=a.block_hash.slice(0,8)+"...";r.oR.warning("\uD83D\uDD04 Chain Reorganization",{description:"Block ".concat(m," disconnected, ").concat(a.transactions.length," txs back to mempool"),action:{label:"View Block",onClick:()=>window.open("https://mempool.space/block/".concat(a.block_hash),"_blank")}});let h=a.transactions.map(e=>({...(0,o.FS)(e),feeRate:1e8*e.fees.base/e.vsize})),x=e=>{let t=new Set(e.map(e=>e.txid));return[...e,...h.filter(e=>!t.has(e.txid))]};u.current?t(x):n(x)}},()=>{e.close(),m.current=null}},[]),l.useEffect(()=>{c&&a.length>0&&(t(e=>{let t=new Set(e.map(e=>e.txid));return[...e,...a.filter(e=>!t.has(e.txid))]}),n([]))},[c,a]),{transactions:e,isFetching:c,toggle:()=>d(e=>!e)}}(),[d]=(0,c.ZA)("txid",c.tU.withDefault("")),u=l.useMemo(()=>e.filter(e=>!d||e.txid.toLowerCase().includes(d.toLowerCase())),[e,d]);return(0,n.jsx)("div",{className:"data-table-container",children:(0,n.jsx)(e0,{data:u,isFetching:t,onToggle:a,showAutoSelectionControls:!0})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[105,277,671,184,622,464,904,334,320,57,948,762,648,441,684,358],()=>t(6550)),_N_E=e.O()}]);